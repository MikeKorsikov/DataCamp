<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointments - Laserovo</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)), url('assets/appointments.png'); background-size: cover; background-position: center; background-attachment: fixed; background-repeat: no-repeat;">
    <main style="max-width:1000px;margin:40px auto;padding:20px;">
        <h1>Managing visits</h1>
        <p>Time to grill that beaver!</p>
        <div class="actions">
            <button id="make-appointment">Make appointment</button>
            <button id="find-appointment">Find appointment</button>
            <button id="show-all">Show all</button>
            <button id="upcoming-appointments">Forecasted appointments</button>
        </div>
        <button class="back-button" onclick="location.href='index.html'">Back to Home</button>
    </main>
    
    <!-- Make Appointment Modal -->
    <div class="modal-overlay" id="appointment-modal-overlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="appointment-modal-title">
            <div class="modal-header">
                <h2 id="appointment-modal-title">Make Appointment</h2>
            </div>
            <form id="appointment-form" class="modal-body">
                <!-- Client Search Section -->
                <div class="form-section">
                    <h3>Client Search</h3>
                    <div class="form-grid">
                        <label>
                            <span>Search by:</span>
                            <select id="client-search-field">
                                <option value="name">Name</option>
                                <option value="surname">Surname</option>
                                <option value="phone">Phone</option>
                            </select>
                        </label>
                        <label>
                            <span>Search term:</span>
                            <input type="text" id="client-search-term" placeholder="Enter search term...">
                        </label>
                        <div class="button-container">
                            <button type="button" id="search-client-btn">Search Client</button>
                        </div>
                    </div>
                    <div id="client-search-results" class="search-results" hidden>
                        <h4>Search Results</h4>
                        <div id="client-results-list"></div>
                    </div>
                </div>

                <!-- Client Information Section -->
                <div class="form-section">
                    <h3>Client Information</h3>
                    <div class="form-grid">
                        <label>
                            <span>Name</span>
                            <input type="text" id="appointment-name" name="name" readonly>
                        </label>
                        <label>
                            <span>Surname</span>
                            <input type="text" id="appointment-surname" name="surname" readonly>
                        </label>
                    </div>
                </div>

                <!-- Appointment Details Section -->
                <div class="form-section">
                    <h3>Appointment Details</h3>
                    <div class="form-grid">
                        <label>
                            <span>Date</span>
                            <input type="date" id="appointment-date" name="appointment_date" required>
                        </label>
                        <label>
                            <span>Time <small>(24-hour format)</small></span>
                            <input type="time" id="appointment-time" name="appointment_time" required step="900">
                        </label>
                        <label>
                            <span>Area [Zone]</span>
                            <select id="appointment-area" name="area" required>
                                
                                <!-- Areas will be populated by JavaScript -->
                            </select>
                        </label>
                        <label>
                            <span>Power</span>
                            <input type="text" id="appointment-power" name="power" placeholder="Enter power setting">
                        </label>
                        <label>
                            <span>Confirmed</span>
                            <select id="appointment-confirmed" name="confirmed">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </label>
                        <label>
                            <span>Amount (PLN)</span>
                            <input type="number" id="appointment-amount" name="amount_pln" placeholder="0.00" step="0.01" min="0">
                        </label>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" id="appointment-save">Save</button>
                    <button type="button" id="appointment-cancel" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Find Appointment Modal -->
    <div class="modal-overlay" id="find-appointment-modal-overlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="find-appointment-modal-title">
            <div class="modal-header">
                <h2 id="find-appointment-modal-title">Find Appointment</h2>
            </div>
            <form id="find-appointment-form" class="modal-body">
                <div class="form-grid">
                    <label>
                        <span>Search by:</span>
                        <select id="appointment-search-field">
                            <option value="name">Name</option>
                            <option value="surname">Surname</option>
                            <option value="phone">Phone</option>
                            <option value="date">Appointment Date</option>
                        </select>
                    </label>
                    <label>
                        <span>Search term:</span>
                        <input type="text" id="appointment-search-term" placeholder="Enter search term..." required>
                    </label>
                </div>
                <div id="appointment-search-results" class="search-results" hidden>
                    <h4>Search Results</h4>
                    <div id="appointment-results-list"></div>
                </div>
                <div class="modal-actions">
                    <button type="submit" id="find-appointment-search">Search</button>
                    <button type="button" id="find-appointment-cancel" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Appointment Modal -->
    <div class="modal-overlay" id="edit-appointment-modal-overlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-appointment-modal-title">
            <div class="modal-header">
                <h2 id="edit-appointment-modal-title">Edit Appointment</h2>
            </div>
            <form id="edit-appointment-form" class="modal-body">
                <!-- Non-editable client information -->
                <div class="client-info-section">
                    <h3>Client Information</h3>
                    <div class="form-grid">
                        <label>
                            <span>Client Name</span>
                            <input type="text" id="edit-appointment-name" name="name" readonly>
                        </label>
                        <label>
                            <span>Client Surname</span>
                            <input type="text" id="edit-appointment-surname" name="surname" readonly>
                        </label>
                    </div>
                </div>
                
                <!-- Editable appointment details -->
                <div class="appointment-details-section">
                    <h3>Appointment Details</h3>
                    <div class="form-grid">
                        <label>
                            <span>Appointment Date & Time <small style="color: #6b7280; font-weight: normal;">(24-hour format)</small></span>
                            <div class="datetime-container">
                                <input type="date" id="edit-appointment-date" name="appointment_date" required>
                                <input type="time" id="edit-appointment-time" name="appointment_time" required step="900">
                            </div>
                        </label>
                        <label>
                            <span>Area [Zone]</span>
                            <select id="edit-appointment-area" name="area" required>
                                
                                <!-- Areas will be populated by JavaScript -->
                            </select>
                        </label>
                        <label>
                            <span>Power</span>
                            <input type="text" id="edit-appointment-power" name="power" placeholder="Enter power setting">
                        </label>
                        <label>
                            <span>Confirmed</span>
                            <select id="edit-appointment-confirmed" name="confirmed">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </label>
                        <label>
                            <span>Amount (PLN)</span>
                            <input type="number" id="edit-appointment-amount" name="amount_pln" placeholder="0.00" step="0.01" min="0">
                        </label>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="submit" id="edit-appointment-save">Save Changes</button>
                    <button type="button" id="edit-appointment-cancel" class="secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Show All Appointments Modal -->
    <div class="modal-overlay" id="show-all-appointments-modal-overlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="show-all-appointments-title">
            <div class="modal-header">
                <h2 id="show-all-appointments-title">All Appointments</h2>
            </div>
            <div class="modal-body" id="show-all-appointments-list">
                <!-- Appointments will be dynamically loaded here -->
            </div>
            <div class="modal-actions" style="justify-content: flex-end;">
                <button type="button" id="show-all-next7">Next 7 days</button>
                <button type="button" id="show-all-next30">Next 30 days</button>
                <button type="button" id="show-all-clear" class="secondary">Clear filter</button>
                <button type="button" id="show-all-appointments-cancel" class="secondary">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Upcoming Appointments Modal -->
    <div class="modal-overlay" id="upcoming-appointments-modal-overlay" hidden>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="upcoming-appointments-title">
            <div class="modal-header">
                <h2 id="upcoming-appointments-title">Forecasted Appointments</h2>
            </div>
            <div class="modal-body">
                <div class="table-wrapper">
                    <table class="data-table" id="upcoming-appointments-table" style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Surname</th>
                                <th>Area</th>
                                <th>Last Visit</th>
                                <th>Procedure #</th>
                                <th>Proposed next date</th>
                                <th>Reminder</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-actions" style="justify-content: flex-end;">
                <button type="button" id="upcoming-appointments-next7">Next 7 days</button>
                <button type="button" id="upcoming-appointments-next30">Next 30 days</button>
                <button type="button" id="upcoming-appointments-clear" class="secondary">Clear filter</button>
                <button type="button" id="upcoming-appointments-cancel" class="secondary">Close</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // Function to populate area dropdowns from CONFIG.AREAS
        function populateAreaDropdowns() {
            const areaSelects = [
                document.getElementById('appointment-area'),
                document.getElementById('edit-appointment-area')
            ];

            // Filter out placeholder areas and sort alphabetically
            const validAreas = CONFIG.AREAS
                .filter(area => !['placeholder2', 'placeholder3'].includes(area.area))
                .sort((a, b) => a.area.localeCompare(b.area));

            areaSelects.forEach(select => {
                if (!select) return;
                
                // Keep the first option (Select Area)
                const firstOption = select.querySelector('option');
                select.innerHTML = '';
                if (firstOption) select.appendChild(firstOption);
                
                // Add areas from CONFIG.AREAS
                validAreas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area.area;
                    option.textContent = area.area
                        .split('-')
                        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                        .join(' ');
                    select.appendChild(option);
                });
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', populateAreaDropdowns);
    </script>
</body>
</html>
